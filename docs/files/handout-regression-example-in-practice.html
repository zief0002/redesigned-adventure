<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-08-05">

<title>EPsy 8264 - A Regression Example</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="../site_libs/pagedtable/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable/js/pagedtable.js"></script>
<script src="https://kit.fontawesome.com/e5da75ca36.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../assets/sticky-notes.css">
<link rel="stylesheet" href="../assets/style.css">
<link rel="stylesheet" href="../assets/notes.css">
<link rel="stylesheet" href="../assets/table-styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">EPsy 8264</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments.html" rel="" target="">
 <span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">Instructor &amp; TA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../mission-statements.html" rel="" target="">
 <span class="menu-text">Mission Statements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../umn-policies.html" rel="" target="">
 <span class="menu-text">University Policies</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#examine-the-data" id="toc-examine-the-data" class="nav-link active" data-scroll-target="#examine-the-data">Examine the Data</a></li>
  <li><a href="#use-matrix-algebra-to-compute-coefficient-estimates" id="toc-use-matrix-algebra-to-compute-coefficient-estimates" class="nav-link" data-scroll-target="#use-matrix-algebra-to-compute-coefficient-estimates">Use Matrix Algebra to Compute Coefficient Estimates</a></li>
  <li><a href="#compute-residual-standard-error" id="toc-compute-residual-standard-error" class="nav-link" data-scroll-target="#compute-residual-standard-error">Compute Residual Standard Error</a></li>
  <li><a href="#compute-variancecovariance-matrix-for-the-coefficients" id="toc-compute-variancecovariance-matrix-for-the-coefficients" class="nav-link" data-scroll-target="#compute-variancecovariance-matrix-for-the-coefficients">Compute Variance–Covariance Matrix for the Coefficients</a></li>
  <li><a href="#coefficient-level-inference" id="toc-coefficient-level-inference" class="nav-link" data-scroll-target="#coefficient-level-inference">Coefficient-Level Inference</a></li>
  <li><a href="#statistical-inference-confidence-intervals-for-the-coefficients" id="toc-statistical-inference-confidence-intervals-for-the-coefficients" class="nav-link" data-scroll-target="#statistical-inference-confidence-intervals-for-the-coefficients">Statistical Inference: Confidence Intervals for the Coefficients</a></li>
  <li><a href="#anova-decompostion" id="toc-anova-decompostion" class="nav-link" data-scroll-target="#anova-decompostion">ANOVA Decompostion</a></li>
  <li><a href="#model-level-inference" id="toc-model-level-inference" class="nav-link" data-scroll-target="#model-level-inference">Model-Level Inference</a></li>
  <li><a href="#in-practice" id="toc-in-practice" class="nav-link" data-scroll-target="#in-practice">In Practice</a>
  <ul class="collapse">
  <li><a href="#accessing-regression-matrices-from-lm" id="toc-accessing-regression-matrices-from-lm" class="nav-link" data-scroll-target="#accessing-regression-matrices-from-lm">Accessing Regression Matrices from lm()</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Regression Example</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 5, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<hr>
<p>In this document we will use the data in <a href="https://github.com/zief0002/epsy-8264/raw/master/data/contraception.csv">contraception.csv</a> to examine whether female education level explains variation in contraceptive useage after controlling for GNI.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>contraception <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"https://github.com/zief0002/epsy-8264/raw/master/data/contraception.csv"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View data</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>contraception</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["contraceptive"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["educ_female"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["gni"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"Algeria","2":"Middle East and North Africa","3":"57","4":"5.9","5":"High"},{"1":"Austria","2":"Europe and Central Asia","3":"66","4":"8.9","5":"High"},{"1":"Azerbaijan","2":"Europe and Central Asia","3":"55","4":"10.5","5":"High"},{"1":"Bangladesh","2":"South Asia","3":"62","4":"4.6","5":"Low"},{"1":"Belgium","2":"Europe and Central Asia","3":"67","4":"10.5","5":"High"},{"1":"Belize","2":"Latin America and the Caribbean","3":"51","4":"9.2","5":"High"},{"1":"Benin","2":"Sub-Saharan Africa","3":"16","4":"2.0","5":"Low"},{"1":"Bolivia","2":"Latin America and the Caribbean","3":"67","4":"8.4","5":"Low"},{"1":"Bosnia and Herzegovina","2":"Europe and Central Asia","3":"46","4":"7.2","5":"High"},{"1":"Botswana","2":"Sub-Saharan Africa","3":"53","4":"8.7","5":"High"},{"1":"Bulgaria","2":"Europe and Central Asia","3":"69","4":"10.6","5":"High"},{"1":"Burkina Faso","2":"Sub-Saharan Africa","3":"32","4":"1.9","5":"Low"},{"1":"Burundi","2":"Sub-Saharan Africa","3":"29","4":"2.2","5":"Low"},{"1":"Cambodia","2":"East Asia and Pacific","3":"56","4":"3.2","5":"Low"},{"1":"Cameroon","2":"Sub-Saharan Africa","3":"34","4":"5.1","5":"Low"},{"1":"Canada","2":"North America","3":"85","4":"12.3","5":"High"},{"1":"Chad","2":"Sub-Saharan Africa","3":"6","4":"0.6","5":"Low"},{"1":"Chile","2":"Latin America and the Caribbean","3":"76","4":"9.6","5":"High"},{"1":"Colombia","2":"Latin America and the Caribbean","3":"81","4":"7.0","5":"High"},{"1":"Congo, Democratic Republic","2":"Sub-Saharan Africa","3":"20","4":"2.1","5":"Low"},{"1":"Costa Rica","2":"Latin America and the Caribbean","3":"78","4":"8.4","5":"High"},{"1":"Croatia","2":"Europe and Central Asia","3":"69","4":"10.5","5":"High"},{"1":"Czech Republic","2":"Europe and Central Asia","3":"86","4":"12.1","5":"High"},{"1":"Dominican Republic","2":"Latin America and the Caribbean","3":"70","4":"7.7","5":"High"},{"1":"Ecuador","2":"Latin America and the Caribbean","3":"80","4":"7.4","5":"High"},{"1":"Egypt, Arab Republic","2":"Middle East and North Africa","3":"59","4":"5.3","5":"Low"},{"1":"El Salvador","2":"Latin America and the Caribbean","3":"72","4":"6.1","5":"Low"},{"1":"Ethiopia","2":"Sub-Saharan Africa","3":"40","4":"1.4","5":"Low"},{"1":"France","2":"Europe and Central Asia","3":"78","4":"10.9","5":"High"},{"1":"Ghana","2":"Sub-Saharan Africa","3":"31","4":"5.9","5":"Low"},{"1":"Greece","2":"Europe and Central Asia","3":"76","4":"9.9","5":"High"},{"1":"Guinea","2":"Sub-Saharan Africa","3":"9","4":"0.8","5":"Low"},{"1":"Haiti","2":"Latin America and the Caribbean","3":"34","4":"3.2","5":"Low"},{"1":"Honduras","2":"Latin America and the Caribbean","3":"73","4":"5.3","5":"Low"},{"1":"Hungary","2":"Europe and Central Asia","3":"62","4":"11.2","5":"High"},{"1":"India","2":"South Asia","3":"54","4":"3.2","5":"Low"},{"1":"Indonesia","2":"East Asia and Pacific","3":"61","4":"6.9","5":"Low"},{"1":"Iraq","2":"Middle East and North Africa","3":"53","4":"4.4","5":"High"},{"1":"Italy","2":"Europe and Central Asia","3":"65","4":"9.7","5":"High"},{"1":"Jamaica","2":"Latin America and the Caribbean","3":"73","4":"9.8","5":"High"},{"1":"Japan","2":"East Asia and Pacific","3":"40","4":"11.2","5":"High"},{"1":"Jordan","2":"Middle East and North Africa","3":"52","4":"9.4","5":"High"},{"1":"Kazakhstan","2":"Europe and Central Asia","3":"55","4":"10.2","5":"High"},{"1":"Kenya","2":"Sub-Saharan Africa","3":"61","4":"5.4","5":"Low"},{"1":"Korea, Republic","2":"East Asia and Pacific","3":"80","4":"11.1","5":"High"},{"1":"Lao PDR","2":"East Asia and Pacific","3":"54","4":"3.8","5":"Low"},{"1":"Lebanon","2":"Middle East and North Africa","3":"55","4":"7.6","5":"High"},{"1":"Lesotho","2":"Sub-Saharan Africa","3":"60","4":"6.8","5":"Low"},{"1":"Liberia","2":"Sub-Saharan Africa","3":"31","4":"2.3","5":"Low"},{"1":"Madagascar","2":"Sub-Saharan Africa","3":"48","4":"4.8","5":"Low"},{"1":"Malawi","2":"Sub-Saharan Africa","3":"59","4":"3.4","5":"Low"},{"1":"Malaysia","2":"East Asia and Pacific","3":"52","4":"9.2","5":"High"},{"1":"Maldives","2":"South Asia","3":"19","4":"5.4","5":"High"},{"1":"Mali","2":"Sub-Saharan Africa","3":"16","4":"1.4","5":"Low"},{"1":"Malta","2":"Middle East and North Africa","3":"86","4":"9.5","5":"High"},{"1":"Mauritius","2":"Sub-Saharan Africa","3":"64","4":"8.0","5":"High"},{"1":"Mexico","2":"Latin America and the Caribbean","3":"67","4":"8.1","5":"High"},{"1":"Moldova","2":"Europe and Central Asia","3":"60","4":"9.6","5":"Low"},{"1":"Mongolia","2":"East Asia and Pacific","3":"55","4":"8.5","5":"Low"},{"1":"Morocco","2":"Middle East and North Africa","3":"71","4":"3.2","5":"Low"},{"1":"Mozambique","2":"Sub-Saharan Africa","3":"27","4":"0.8","5":"Low"},{"1":"Namibia","2":"Sub-Saharan Africa","3":"56","4":"6.3","5":"High"},{"1":"Nepal","2":"South Asia","3":"53","4":"2.4","5":"Low"},{"1":"Nicaragua","2":"Latin America and the Caribbean","3":"80","4":"4.8","5":"Low"},{"1":"Niger","2":"Sub-Saharan Africa","3":"11","4":"0.8","5":"Low"},{"1":"Nigeria","2":"Sub-Saharan Africa","3":"28","4":"4.2","5":"Low"},{"1":"Pakistan","2":"South Asia","3":"34","4":"3.3","5":"Low"},{"1":"Panama","2":"Latin America and the Caribbean","3":"63","4":"9.6","5":"High"},{"1":"Paraguay","2":"Latin America and the Caribbean","3":"68","4":"7.5","5":"High"},{"1":"Philippines","2":"East Asia and Pacific","3":"54","4":"8.8","5":"Low"},{"1":"Portugal","2":"Europe and Central Asia","3":"74","4":"8.0","5":"High"},{"1":"Romania","2":"Europe and Central Asia","3":"70","4":"10.4","5":"High"},{"1":"Rwanda","2":"Sub-Saharan Africa","3":"53","4":"3.1","5":"Low"},{"1":"Sao Tome and Principe","2":"Sub-Saharan Africa","3":"41","4":"4.0","5":"Low"},{"1":"Senegal","2":"Sub-Saharan Africa","3":"28","4":"3.4","5":"Low"},{"1":"Serbia","2":"Europe and Central Asia","3":"58","4":"9.2","5":"High"},{"1":"Sierra Leone","2":"Sub-Saharan Africa","3":"23","4":"2.0","5":"Low"},{"1":"Slovak Republic","2":"Europe and Central Asia","3":"80","4":"11.6","5":"High"},{"1":"Slovenia","2":"Europe and Central Asia","3":"79","4":"11.8","5":"High"},{"1":"South Africa","2":"Sub-Saharan Africa","3":"55","4":"9.8","5":"High"},{"1":"Spain","2":"Europe and Central Asia","3":"71","4":"9.5","5":"High"},{"1":"Suriname","2":"Latin America and the Caribbean","3":"48","4":"7.3","5":"High"},{"1":"Swaziland","2":"Sub-Saharan Africa","3":"66","4":"7.4","5":"Low"},{"1":"Tajikistan","2":"Europe and Central Asia","3":"29","4":"10.0","5":"Low"},{"1":"Tanzania","2":"Sub-Saharan Africa","3":"38","4":"4.5","5":"Low"},{"1":"Thailand","2":"East Asia and Pacific","3":"78","4":"7.0","5":"High"},{"1":"Togo","2":"Sub-Saharan Africa","3":"20","4":"3.3","5":"Low"},{"1":"Tunisia","2":"Middle East and North Africa","3":"63","4":"5.5","5":"Low"},{"1":"Uganda","2":"Sub-Saharan Africa","3":"42","4":"4.3","5":"Low"},{"1":"Ukraine","2":"Europe and Central Asia","3":"65","4":"11.2","5":"Low"},{"1":"United Kingdom","2":"Europe and Central Asia","3":"84","4":"12.8","5":"High"},{"1":"Uruguay","2":"Latin America and the Caribbean","3":"80","4":"8.7","5":"High"},{"1":"Venezuela, RB","2":"Latin America and the Caribbean","3":"75","4":"8.7","5":"High"},{"1":"Vietnam","2":"East Asia and Pacific","3":"76","4":"5.2","5":"Low"},{"1":"Yemen, Republic","2":"Middle East and North Africa","3":"34","4":"1.2","5":"Low"},{"1":"Zambia","2":"Sub-Saharan Africa","3":"49","4":"5.8","5":"Low"},{"1":"Zimbabwe","2":"Sub-Saharan Africa","3":"67","4":"6.7","5":"Low"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IF you want to see all the variables</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(contraception, width = Inf)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="examine-the-data" class="level2">
<h2 class="anchored" data-anchor-id="examine-the-data">Examine the Data</h2>
<p>We need to correctly specify the model. Since we have no theory to guide us, this is done empirically by looking at the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatterplot</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> contraception, <span class="fu">aes</span>(<span class="at">x =</span> educ_female, <span class="at">y =</span> contraceptive)) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Female education level"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Contraceptive useage"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add marginal density plots</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(p, <span class="at">type =</span> <span class="st">"density"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Condition the relationship on GNI</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> contraception, <span class="fu">aes</span>(<span class="at">x =</span> educ_female, <span class="at">y =</span> contraceptive, <span class="at">color =</span> gni)) <span class="sc">+</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Female education level"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Contraceptive useage"</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="sc">~</span>gni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout-regression-example-in-practice_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="handout-regression-example-in-practice_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" style="width:45.0%"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Should we include main-effects only? Or an interaction?</li>
<li>Is there non-linearity to account for (e.g., transformations)? Or does it look linear?</li>
</ul>
<p><br></p>
</section>
<section id="use-matrix-algebra-to-compute-coefficient-estimates" class="level2">
<h2 class="anchored" data-anchor-id="use-matrix-algebra-to-compute-coefficient-estimates">Use Matrix Algebra to Compute Coefficient Estimates</h2>
<p><span class="math display">\[
\mathbf{b} = (\mathbf{X}^\intercal\mathbf{X})^{-1} \mathbf{X}^\intercal\mathbf{y}
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store values</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">nrow</span>(contraception) <span class="co">#Sample size</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">2</span> <span class="co">#Number of predictors</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create outcome vector</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> contraception<span class="sc">$</span>contraceptive</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dummy variable for GNI</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>contraception <span class="ot">=</span> contraception <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">high_gni =</span> <span class="fu">if_else</span>(gni <span class="sc">==</span> <span class="st">"High"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design matrix</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n), contraception<span class="sc">$</span>educ_female, contraception<span class="sc">$</span>high_gni),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>   <span class="at">ncol =</span> <span class="dv">3</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute b vector</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> y</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]
[1,] 27.021387
[2,]  4.088735
[3,]  1.608766</code></pre>
</div>
</div>
<p>Thus the fitted regression equation is:</p>
<p><span class="math display">\[
\widehat{\mathrm{Contraceptive~Use}}_i = 27.02 + 4.09(\mathrm{Female~Education~Level}_i) + 1.60(\mathrm{High~GNI}_i)
\]</span></p>
<p><br></p>
</section>
<section id="compute-residual-standard-error" class="level2">
<h2 class="anchored" data-anchor-id="compute-residual-standard-error">Compute Residual Standard Error</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute e vector</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> y <span class="sc">-</span> X <span class="sc">%*%</span> b</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute s_e</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>s_e <span class="ot">=</span> <span class="fu">sqrt</span>((<span class="fu">t</span>(e) <span class="sc">%*%</span> e) <span class="sc">/</span> (n <span class="sc">-</span> k <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>s_e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 14.39792</code></pre>
</div>
</div>
<p>Thus the residual standard error (a.k.a., the root mean square error; RMSE) is:</p>
<p><span class="math display">\[
s_e = 14.40
\]</span></p>
<p><br></p>
</section>
<section id="compute-variancecovariance-matrix-for-the-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="compute-variancecovariance-matrix-for-the-coefficients">Compute Variance–Covariance Matrix for the Coefficients</h2>
<p><span class="math display">\[
\mathrm{Var}(\mathbf{b}) = s^2_e(\mathbf{X}^\intercal\mathbf{X})^{-1}
\]</span></p>
<p>where <span class="math inline">\(s^2_e = \frac{\mathbf{e}^\intercal\mathbf{e}}{n-k-1}\)</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute varaince-covariance matrix of b</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>V <span class="ot">=</span> <span class="fu">as.numeric</span>(s_e<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]       [,2]      [,3]
[1,] 12.414688 -1.8783934  4.782603
[2,] -1.878393  0.4267136 -2.028306
[3,]  4.782603 -2.0283060 18.197825</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute SEs for b</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">diag</span>(V))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.5234483 0.6532332 4.2658909</code></pre>
</div>
</div>
<p>Thus</p>
<p><span class="math display">\[
\mathrm{SE}(b_0) = 3.52 \qquad \mathrm{SE}(b_1) = 0.65 \qquad \mathrm{SE}(b_2) = 4.27
\]</span></p>
<p><br></p>
</section>
<section id="coefficient-level-inference" class="level2">
<h2 class="anchored" data-anchor-id="coefficient-level-inference">Coefficient-Level Inference</h2>
<p>Here we will focus on the effects of female education level since it is our focal predictor. (GNI is a control.) Note this is the second effect in the <strong>b</strong> vector and in the <strong>V</strong> matrix. We will test the hypothesis:</p>
<p><span class="math display">\[
H_0: \beta_{\mathrm{Education}} = 0
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute t-value</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>t_0 <span class="ot">=</span> (b[<span class="dv">2</span>] <span class="sc">-</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">sqrt</span>(V[<span class="dv">2</span>, <span class="dv">2</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>t_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.259228</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate t-value</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> n <span class="sc">-</span> k <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t_0), <span class="at">df =</span> df))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00000001143799</code></pre>
</div>
</div>
<p>Here,</p>
<p><span class="math display">\[
t(94) = 6.26,~p=0.0000000114
\]</span></p>
<p>The evidence suggests that the data are not very compatible with the hypothesis that there is no effect of female education level on contraceptive useage, after controlling for differences in GNI.</p>
<p><br></p>
</section>
<section id="statistical-inference-confidence-intervals-for-the-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="statistical-inference-confidence-intervals-for-the-coefficients">Statistical Inference: Confidence Intervals for the Coefficients</h2>
<p>From the hypothesis test, we believe there is an effect of female education level on contraceptive useage, after controlling for differences in GNI. What is that effect? To answer this we will compute a 95% CI for the effect of female education.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute critical value</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>t_star <span class="ot">=</span> <span class="fu">qt</span>(.<span class="dv">025</span>, <span class="at">df =</span> df)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute CI</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>b[<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">abs</span>(t_star) <span class="sc">*</span> <span class="fu">sqrt</span>(V[<span class="dv">2</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.791725</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>b[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">abs</span>(t_star) <span class="sc">*</span> <span class="fu">sqrt</span>(V[<span class="dv">2</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.385745</code></pre>
</div>
</div>
<p>The 95% CI indicates that the population effect of female education level on contraceptive useage, after controlling for differences in GNI is between 2.79 and 5.39.</p>
<p><br></p>
</section>
<section id="anova-decompostion" class="level1">
<h1>ANOVA Decompostion</h1>
<p>Here we want to partition the sums of squares:</p>
<p><span class="math display">\[
\mathrm{SS}_{\mathrm{Total}} = \mathrm{SS}_{\mathrm{Model}} + \mathrm{SS}_{\mathrm{Residual}}
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute needed values</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mean_y <span class="ot">=</span> <span class="fu">mean</span>(y)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>hat_y <span class="ot">=</span> X <span class="sc">%*%</span> b</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute SS_Total</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>ss_total <span class="ot">=</span> <span class="fu">t</span>(y <span class="sc">-</span> mean_y) <span class="sc">%*%</span> (y <span class="sc">-</span> mean_y)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ss_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 38336.45</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute SS_model</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ss_model <span class="ot">=</span> <span class="fu">t</span>(hat_y <span class="sc">-</span> mean_y) <span class="sc">%*%</span> (hat_y <span class="sc">-</span> mean_y)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ss_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 18850.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute SS_residual</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ss_residual <span class="ot">=</span> <span class="fu">t</span>(y <span class="sc">-</span> hat_y) <span class="sc">%*%</span> (y <span class="sc">-</span> hat_y)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ss_residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]
[1,] 19486.2</code></pre>
</div>
</div>
<p>Here:</p>
<ul>
<li><span class="math inline">\(\mathrm{SS}_{\mathrm{Total}}=38,336.45\)</span></li>
<li><span class="math inline">\(\mathrm{SS}_{\mathrm{Model}}=18,850.25\)</span></li>
<li><span class="math inline">\(\mathrm{SS}_{\mathrm{Residual}}=19,486.2\)</span></li>
</ul>
<p>We can verify that:</p>
<p><span class="math display">\[
38,336.45 = 18,850.25 + 19,486.2
\]</span></p>
<p>This can be used to compute the model-level <span class="math inline">\(R^2\)</span> value.</p>
<p><span class="math display">\[
R^2 = \frac{\mathrm{SS}_{\mathrm{Model}}}{\mathrm{SS}_{\mathrm{Total}}}
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute R^2</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">=</span> ss_model <span class="sc">/</span> ss_total</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>r2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]
[1,] 0.4917057</code></pre>
</div>
</div>
<p>The model explains 49.1% of the variation in contraception usage.</p>
<p><br></p>
</section>
<section id="model-level-inference" class="level1">
<h1>Model-Level Inference</h1>
<p>Here we want to test whether the model explained variation is more than we would expect because of sampling variation, namely</p>
<p><span class="math display">\[
H_0: \rho^2=0
\]</span></p>
<p>This is equivalent to testing:</p>
<p><span class="math display">\[
H_0: \beta_{\mathrm{Female~Education}} = \beta_{\mathrm{GNI}} = 0
\]</span></p>
<p>We compute an observed <em>F</em>-value as:</p>
<p><span class="math display">\[
F_0 = \frac{(\mathbf{Lb}-\mathbf{c})^\intercal\big[\mathbf{L}(\mathbf{X}^\intercal\mathbf{X})^{-1}\mathbf{L}^\intercal\big]^{-1}(\mathbf{Lb}-\mathbf{c})}{q(s^2_e)}
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create L (hypothesis matrix)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">=</span> <span class="fu">matrix</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">ncol =</span> <span class="dv">3</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create vector of hypothesized values</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>C <span class="ot">=</span> <span class="fu">matrix</span>(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">ncol =</span> <span class="dv">1</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>F_num <span class="ot">=</span> <span class="fu">t</span>(L <span class="sc">%*%</span> b <span class="sc">-</span> C) <span class="sc">%*%</span> <span class="fu">solve</span>(L <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(L)) <span class="sc">%*%</span> (L <span class="sc">%*%</span> b <span class="sc">-</span> C)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>F_denom <span class="ot">=</span> q <span class="sc">*</span> s_e<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>F_0 <span class="ot">=</span> F_num <span class="sc">/</span> F_denom</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>F_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 45.46611</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate F_0</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(F_0, <span class="at">df1 =</span> q, <span class="at">df2 =</span> (n <span class="sc">-</span> k <span class="sc">-</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]
[1,] 1.532108e-14</code></pre>
</div>
</div>
<p>Here,</p>
<p><span class="math display">\[
F(2, 94) = 45.47,~p=0.0000000000000153
\]</span></p>
<p>The data are not very compatible with the hypothesis that the model explains no variation in the outcome. It is likely there is a controlled effect of female education level, or GNI (or both) on contraceptive usage. That is, the explained variation of 49.1% is more than we would expect because of chance.</p>
<p><br></p>
</section>
<section id="in-practice" class="level1">
<h1>In Practice</h1>
<p>In practice, you would simply use built-in R functions to do all of this. Note that you can use a categorical variable in the <code>lm()</code> function directly (without dummy coding it beforehand), but it will pick the reference category for you (alphabetically). For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(contraceptive <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> educ_female <span class="sc">+</span> gni, <span class="at">data =</span> contraception)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficient-level output</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"28.630153","3":"6.3385897","4":"4.516802","5":"0.00001821782737"},{"1":"educ_female","2":"4.088735","3":"0.6532332","4":"6.259228","5":"0.00000001143798"},{"1":"gniLow","2":"-1.608766","3":"4.2658909","4":"-0.377123","5":"0.70693222349564"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coempute confidence intervals for coefficients</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept)  16.044734 41.215571
educ_female   2.791725  5.385745
gniLow      -10.078792  6.861261</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model-level output</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[11],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[12],"type":["int"],"align":["right"]}],"data":[{"1":"0.4917057","2":"0.4808909","3":"14.39792","4":"45.46611","5":"1.539636e-14","6":"2","7":"-394.8205","8":"797.6409","9":"807.9398","10":"19486.2","11":"94","12":"97"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA decomposition</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["int"],"align":["right"]},{"label":["Sum Sq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Mean Sq"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["F value"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"18820.76855","3":"18820.76855","4":"90.7899959","5":"1.849680e-15","_rn_":"educ_female"},{"1":"1","2":"29.48258","3":"29.48258","4":"0.1422218","5":"7.069322e-01","_rn_":"gni"},{"1":"94","2":"19486.20248","3":"207.30003","4":"NA","5":"NA","_rn_":"Residuals"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<section id="accessing-regression-matrices-from-lm" class="level2">
<h2 class="anchored" data-anchor-id="accessing-regression-matrices-from-lm">Accessing Regression Matrices from lm()</h2>
<p>There are several built-in R functions that allow you to access different regression matrices once you have fitted a model with <code>lm()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access design matrix</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>   (Intercept) educ_female gniLow
1            1         5.9      0
2            1         8.9      0
3            1        10.5      0
4            1         4.6      1
:            :          :       :
97           1         6.7      1
attr(,"assign")
[1] 0 1 2
attr(,"contrasts")
attr(,"contrasts")$gni
[1] "contr.treatment"</code></pre>
<p>The design matrix is given and information about this design matrix is also encoded. There is an attribute “assign”, an integer vector with an entry for each column in the matrix giving the term in the formula which gave rise to the column. Value 0 corresponds to the intercept (if any), and positive values to terms in the order given by the term.labels attribute of the terms structure corresponding to object. There is also an attribute called “contrasts” that identifies any factors (categorical variables) in the model and indicates how the contrast testing (comparison of the factor levels) will be carried out. Here “contr.treatment” is used. This compares each level of the factor to the baseline (which is how dummy coding works).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access coefficient estimates</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) educ_female      gniLow 
  28.630153    4.088735   -1.608766 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access variance-covariance matrix for b</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            (Intercept) educ_female     gniLow
(Intercept)   40.177719  -3.9066994 -22.980428
educ_female   -3.906699   0.4267136   2.028306
gniLow       -22.980428   2.0283060  18.197825</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access fitted values</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
52.75369 65.01990 71.56187 45.82957 71.56187 66.24652 35.19886 61.36676 
       9       10       11       12       13       14       15       16 
58.06905 64.20215 71.97075 34.78998 36.01660 40.10534 47.87394 78.92160 
      17       18       19       20       21       22       23       24 
29.47463 67.88201 57.25130 35.60773 62.97553 71.56187 78.10385 60.11341 
      25       26       27       28       29       30       31       32 
58.88679 48.69168 51.96267 32.74562 73.19737 51.14493 69.10863 30.29238 
      33       34       35       36       37       38       39       40 
40.10534 48.69168 74.42399 40.10534 55.23366 46.62059 68.29089 68.69976 
      41       42       43       44       45       46       47       48 
74.42399 67.06427 70.33525 49.10056 74.01512 42.55858 59.70454 54.82479 
      49       50       51       52       53       54       55       56 
36.42548 46.64732 40.92309 66.24652 50.70932 32.74562 67.47314 61.34004 
      57       58       59       60       61       62       63       64 
61.74891 66.27325 61.77564 40.10534 30.29238 54.38919 36.83435 46.64732 
      65       66       67       68       69       70       71       72 
30.29238 44.19408 40.51421 67.88201 59.29567 63.00226 61.34004 71.15300 
      73       74       75       76       77       78       79       80 
39.69647 43.37633 40.92309 66.24652 35.19886 76.05948 76.87723 68.69976 
      81       82       83       84       85       86       87       88 
67.47314 58.47792 57.27803 67.90874 45.42070 57.25130 40.51421 49.50943 
      89       90       91       92       93       94       95       96 
44.60295 72.81522 80.96597 64.20215 64.20215 48.28281 31.92787 50.73605 
      97 
54.41591 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access raw residuals</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(lm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1           2           3           4           5           6 
  4.2463087   0.9801026 -16.5618739  16.1704304  -4.5618739 -15.2465180 
          7           8           9          10          11          12 
-19.1988577   5.6332361 -12.0690473 -11.2021503  -2.9707474  -2.7899842 
         13          14          15          16          17          18 
 -7.0166048  15.8946599 -13.8739373   6.0784025 -23.4746282   8.1179879 
         19          20          21          22          23          24 
 23.7486998 -15.6077312  15.0244703  -2.5618739   7.8961495   9.8865851 
         25          26          27          28          29          30 
 21.1132057  10.3083157  20.0373274   7.2543835   4.8026319 -20.1449256 
         31          32          33          34          35          36 
  6.8913673 -21.2923753  -6.1053401  24.3083157 -12.4239887  13.8946599 
         37          38          39          40          41          42 
  5.7663391   6.3794117  -3.2908856   4.3002408 -34.4239887 -15.0642650 
         43          44          45          46          47          48 
-15.3352533  11.8994421   5.9848849  11.4414187  -4.7045414   5.1752126 
         49          50          51          52          53          54 
 -5.4254783   1.3526833  18.0769128 -14.2465180 -31.7093236 -16.7456165 
         55          56          57          58          59          60 
 18.5268614   2.6599645   5.2510909  -6.2732463  -6.7756375  30.8946599 
         61          62          63          64          65          66 
 -3.2923753   1.6108145  16.1656482  33.3526833 -19.2923753 -16.1940755 
         67          68          69          70          71          72 
 -6.5142136  -4.8820121   8.7043321  -9.0022581  12.6599645  -1.1530004 
         73          74          75          76          77          78 
 13.3035334  -2.3763284 -12.9230872  -8.2465180 -12.1988577   3.9405172 
         79          80          81          82          83          84 
  2.1227701 -13.6997592   3.5268614 -10.4779208   8.7219714 -38.9087405 
         85          86          87          88          89          90 
 -7.4206961  20.7486998 -20.5142136  13.4905686  -2.6029490  -7.8152229 
         91          92          93          94          95          96 
  3.0340348  15.7978497  10.7978497  27.7171892   2.0721306  -1.7360520 
         97 
 12.5840862 </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>