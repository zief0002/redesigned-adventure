<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-10-13">

<title>EPsy 8264 - üìù Cross Validation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../site_libs/kePrint/kePrint.js"></script>
<link href="../site_libs/lightable/lightable.css" rel="stylesheet">
<link href="../site_libs/pagedtable/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable/js/pagedtable.js"></script>
<script src="https://kit.fontawesome.com/e5da75ca36.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../assets/sticky-notes.css">
<link rel="stylesheet" href="../assets/style.css">
<link rel="stylesheet" href="../assets/notes.css">
<link rel="stylesheet" href="../assets/gt-table-styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">EPsy 8264</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments.html" rel="" target="">
 <span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">Instructor &amp; TA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../mission-statements.html" rel="" target="">
 <span class="menu-text">Mission Statements</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../umn-policies.html" rel="" target="">
 <span class="menu-text">University Policies</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#evaluating-predictors-cross-validation" id="toc-evaluating-predictors-cross-validation" class="nav-link active" data-scroll-target="#evaluating-predictors-cross-validation">Evaluating Predictors: Cross-Validation</a>
  <ul class="collapse">
  <li><a href="#cross-validated-mean-square-error-cv-mse" id="toc-cross-validated-mean-square-error-cv-mse" class="nav-link" data-scroll-target="#cross-validated-mean-square-error-cv-mse">Cross-Validated Mean Square Error (CV-MSE)</a></li>
  </ul></li>
  <li><a href="#cross-validation-example" id="toc-cross-validation-example" class="nav-link" data-scroll-target="#cross-validation-example">Cross-Validation Example</a>
  <ul class="collapse">
  <li><a href="#divide-the-sample-data-into-a-training-and-validation-set" id="toc-divide-the-sample-data-into-a-training-and-validation-set" class="nav-link" data-scroll-target="#divide-the-sample-data-into-a-training-and-validation-set">Divide the Sample Data into a Training and Validation Set</a></li>
  <li><a href="#fit-the-candidate-models-to-the-training-data" id="toc-fit-the-candidate-models-to-the-training-data" class="nav-link" data-scroll-target="#fit-the-candidate-models-to-the-training-data">Fit the Candidate Models to the Training Data</a></li>
  <li><a href="#use-the-coefficients-from-the-fitted-models-and-the-validation-data-to-obtain-fitted-values-residuals-and-cv-mses" id="toc-use-the-coefficients-from-the-fitted-models-and-the-validation-data-to-obtain-fitted-values-residuals-and-cv-mses" class="nav-link" data-scroll-target="#use-the-coefficients-from-the-fitted-models-and-the-validation-data-to-obtain-fitted-values-residuals-and-cv-mses">Use the Coefficients from the Fitted Models and the Validation Data to Obtain Fitted Values, Residuals, and CV-MSEs</a></li>
  <li><a href="#select-candidate-model-with-the-lowest-cv-mse" id="toc-select-candidate-model-with-the-lowest-cv-mse" class="nav-link" data-scroll-target="#select-candidate-model-with-the-lowest-cv-mse">Select Candidate Model with the Lowest CV-MSE</a></li>
  </ul></li>
  <li><a href="#leave-one-out-cross-validation" id="toc-leave-one-out-cross-validation" class="nav-link" data-scroll-target="#leave-one-out-cross-validation">Leave-One-Out Cross-Validation</a>
  <ul class="collapse">
  <li><a href="#function-to-carry-out-loocv" id="toc-function-to-carry-out-loocv" class="nav-link" data-scroll-target="#function-to-carry-out-loocv">Function to Carry Out LOOCV</a></li>
  <li><a href="#alternative-programming-use-a-for-loop" id="toc-alternative-programming-use-a-for-loop" class="nav-link" data-scroll-target="#alternative-programming-use-a-for-loop">Alternative Programming: Use a for() Loop</a></li>
  <li><a href="#select-model-with-lowest-cv-mse" id="toc-select-model-with-lowest-cv-mse" class="nav-link" data-scroll-target="#select-model-with-lowest-cv-mse">Select Model with Lowest CV-MSE</a>
  <ul class="collapse">
  <li><a href="#computing-the-cv-mse-under-loocv-a-shortcut-for-ols-models" id="toc-computing-the-cv-mse-under-loocv-a-shortcut-for-ols-models" class="nav-link" data-scroll-target="#computing-the-cv-mse-under-loocv-a-shortcut-for-ols-models">Computing the CV-MSE under LOOCV: A Shortcut for OLS Models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#k-fold-cross-validation" id="toc-k-fold-cross-validation" class="nav-link" data-scroll-target="#k-fold-cross-validation">k-Fold Cross-Validation</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model Selection</a></li>
  <li><a href="#reporting-results-from-a-cross-validation" id="toc-reporting-results-from-a-cross-validation" class="nav-link" data-scroll-target="#reporting-results-from-a-cross-validation">Reporting Results from a Cross-Validation</a></li>
  <li><a href="#relationship-between-information-criteria-and-cross-validation" id="toc-relationship-between-information-criteria-and-cross-validation" class="nav-link" data-scroll-target="#relationship-between-information-criteria-and-cross-validation">Relationship between Information Criteria and Cross-Validation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">üìù Cross Validation</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 13, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<hr>
<p>In the previous activity, we examined predictors of average life expectancy in a state, using data from <em>states-2019.csv</em>. We used several model building strategies and performance metrics to select and evaluate predictors. Unfortunately, we were evaluating the model/predictors using the same data that we used to build the model. This has several problems in practice, especially if you are using inferential metrics (<em>p</em>-values) to select the predictors:</p>
<ul>
<li><strong>Increased Type I error rates:</strong> If you use <em>p</em>-values to select predictors, there are many tests you are examining across the model selection process. You probably need to adjust the <em>p</em>-values obtained from these tests to accommodate this.</li>
<li><strong>Overfit/Lack of generalization:</strong> The adopted model still has the potential to not perform well on future (out-of-sample) data.</li>
</ul>
<p>One set of methods for dealing with these problems is to use <em>cross-validation</em>. The basic idea of cross-validation is to use one set of data to fit your model(s) and a completely separate set of data to evaluate the models‚Äô performance. We will again use the <em>states-2019.csv</em> data to introduce methods of cross-validation. After importing the data, we will also standardize all the numeric variables.</p>
<ul>
<li><a href="https://raw.githubusercontent.com/zief0002/redesigned-adventure/main/data/states-2019.csv">[CSV]</a></li>
<li><a href="https://raw.githubusercontent.com/zief0002/redesigned-adventure/main/scripts/14-cross-validation.R">[R Script File]</a></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># Loads broom, rsample, parsnip, recipes, workflow, tune, yardstick, and dials</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Import and view data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>usa <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/zief0002/redesigned-adventure/main/data/states-2019.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create standardized variables after removing state names</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>z_usa <span class="ot">=</span> usa <span class="sc">|&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>state) <span class="sc">|&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># View data</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>z_usa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["life_expectancy"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["population"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["illiteracy"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["murder"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["hs_grad"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["frost"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["area"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"-1.875390080","2":"-0.20138748","3":"-0.91513393","4":"0.70500165","5":"0.90297951","6":"-0.955626982","7":"-1.20337822","8":"-0.203318102"},{"1":"0.047863784","2":"-0.77268875","3":"0.86568367","4":"-0.58942761","5":"1.02638276","6":"1.087323115","7":"1.77777264","8":"5.898861811"},{"1":"0.670092975","2":"0.12393888","3":"-0.51795285","4":"0.31204991","5":"0.07000761","6":"-0.610339642","7":"-0.29136266","8":"0.534871825"},{"1":"-1.592558630","2":"-0.45958823","3":"-1.05129416","4":"0.45073876","5":"0.71787464","6":"-0.869305147","7":"-0.82907184","8":"-0.187766018"},{"1":"1.631719907","2":"4.53828023","3":"0.37207930","4":"2.62353075","5":"-0.14594807","6":"-1.761297443","7":"-1.49408318","8":"1.031728623"},{"1":"1.009490716","2":"-0.08422076","3":"0.73291333","4":"-0.42762395","5":"-0.36190375","6":"0.713261830","7":"1.16786223","8":"0.418530501"},{"1":"1.235755877","2":"-0.38461106","3":"2.05421370","4":"-0.72811646","5":"-0.79381510","6":"0.454296324","7":"-0.33506341","8":"-0.742124446"},{"1":"-0.178401377","2":"-0.73951714","3":"0.38093066","4":"-0.24270549","5":"0.03915680","6":"0.195330819","7":"0.14944486","8":"-0.776045594"},{"1":"-0.065268796","2":"-0.77622148","3":"3.27909078","4":"1.67582360","5":"0.31681410","6":"0.483070269","7":"-0.17356065","8":"-0.798276271"},{"1":"0.726659265","2":"2.06847824","3":"-0.35467357","4":"1.83762726","5":"0.10085842","6":"-0.293826246","7":"-1.88168980","8":"-0.165206694"},{"1":"-0.517799117","2":"0.58117080","3":"-0.53678552","4":"1.14418301","5":"0.37851572","6":"-0.667887532","7":"-1.21287839","8":"-0.119172526"},{"1":"2.027683938","2":"-0.67897096","3":"0.23930895","4":"0.95926455","5":"-0.73211348","6":"0.857131555","7":"-2.01659210","8":"-0.723602794"},{"1":"0.330695235","2":"-0.62813651","3":"-0.85260945","4":"-0.28893510","5":"-0.88636754","6":"0.454296324","7":"0.33374800","8":"0.172291130"},{"1":"0.330695235","2":"0.86251823","3":"0.36755946","4":"0.26582030","5":"0.62532221","6":"-0.006086796","7":"0.40784927","8":"-0.146473768"},{"1":"-0.970329438","2":"0.04909661","3":"-0.62624072","4":"-0.86680531","5":"0.50191897","6":"-0.092408631","7":"0.21594599","8":"-0.377970937"},{"1":"0.387261525","2":"-0.44078981","3":"-0.01964031","4":"-0.98237935","5":"-0.97891997","6":"0.914679445","7":"0.77265549","8":"-0.143163816"},{"1":"-0.121835086","2":"-0.47389801","3":"-0.11210873","4":"-0.91303493","5":"-0.30020212","6":"0.540618159","7":"0.38884894","8":"0.161398803"},{"1":"-1.875390080","2":"-0.26103034","3":"-0.90044444","4":"0.10401664","5":"0.19341085","6":"-0.984400927","7":"-0.38256422","8":"-0.332641014"},{"1":"-1.479426049","2":"-0.23622603","3":"-0.69027181","4":"0.98237935","5":"2.01360871","6":"-1.243366432","7":"-1.65558594","8":"-0.287639739"},{"1":"-0.008702506","2":"-0.68878471","3":"-0.09176944","4":"-1.00549416","5":"-0.94806916","6":"1.001001280","7":"1.19446269","8":"-0.436716733"},{"1":"0.217562654","2":"-0.04492411","3":"1.48264206","4":"-0.12713145","5":"0.99553195","6":"0.339200544","7":"-0.23056163","8":"-0.684258957"},{"1":"1.009490716","2":"0.07104732","3":"1.53066538","4":"-0.42762395","5":"-0.88636754","6":"0.483070269","7":"0.26914690","8":"-0.706994342"},{"1":"-0.404666537","2":"0.49481552","3":"-0.34883544","4":"-0.79746089","5":"0.19341085","6":"0.454296324","7":"0.86385705","8":"-0.135370168"},{"1":"1.235755877","2":"-0.10053191","3":"0.78583314","4":"-1.32910148","5":"-0.91721835","6":"1.202418895","7":"1.30086450","8":"0.135506051"},{"1":"-2.158221531","2":"-0.46529283","3":"-1.39913364","4":"0.98237935","5":"0.25511248","6":"-1.502331938","7":"-1.00387482","8":"-0.248342852"},{"1":"-0.800630568","2":"-0.03235933","3":"-0.44055056","4":"-0.98237935","5":"1.55084655","6":"0.166556874","7":"-0.07855903","8":"0.009692627"},{"1":"0.047863784","2":"-0.72650508","3":"-0.46635132","4":"-0.68188685","5":"-0.51615780","6":"1.259966785","7":"1.23816343","8":"0.909459901"},{"1":"0.500394105","2":"-0.60795805","3":"-0.19195927","4":"-1.02860897","5":"-0.79381510","6":"0.655713940","7":"0.98355909","8":"0.103357253"},{"1":"-0.121835086","2":"-0.45104919","3":"-0.50702990","4":"1.00549416","5":"0.56362059","6":"-0.811757257","7":"0.97405893","8":"0.489847075"},{"1":"0.443827815","2":"-0.68666214","3":"1.17246793","4":"-1.37533110","5":"-1.04062159","6":"1.202418895","7":"1.86897419","8":"-0.693719318"},{"1":"0.952924426","2":"0.34353265","3":"1.66155246","4":"1.19041263","5":"-0.51615780","6":"0.166556874","7":"-0.13556001","8":"-0.711912322"},{"1":"-0.348100247","2":"-0.58571469","3":"-0.90063277","4":"1.09795340","5":"0.96468113","6":"-1.041948817","7":"0.09244388","8":"0.625519932"},{"1":"1.462021037","2":"1.79126968","3":"0.87189846","4":"2.39238266","5":"-0.60871024","6":"-0.725435422","7":"0.13424460","8":"-0.244704251"},{"1":"-0.404666537","2":"0.56345798","3":"-0.50684157","4":"0.42762395","5":"0.34766491","6":"-0.495243862","7":"-0.81577161","8":"-0.227168543"},{"1":"0.670092975","2":"-0.76850948","3":"0.86737862","4":"-1.25975705","5":"-0.76296429","6":"1.058549170","7":"1.47566748","8":"0.010819420"},{"1":"-1.026895728","2":"0.72793573","3":"-0.28781758","4":"-0.61254242","5":"-0.02254482","6":"0.339200544","7":"0.28434716","8":"-0.318309622"},{"1":"-1.535992340","2":"-0.33097039","3":"-0.60947964","4":"0.12713145","5":"0.10085842","6":"-0.322600191","7":"-0.57256746","8":"0.007122132"},{"1":"0.613526685","2":"-0.29525879","3":"-0.15429392","4":"-0.35827953","5":"-0.88636754","6":"0.454296324","7":"-0.47186574","8":"0.327835443"},{"1":"-0.234967667","2":"0.88034459","3":"0.14213236","4":"0.19647587","5":"0.37851572","6":"0.367974489","7":"0.16274508","8":"-0.272921013"},{"1":"0.670092975","2":"-0.72779473","3":"0.44533840","4":"-0.75123127","5":"-1.04062159","6":"-0.380148081","7":"0.14944486","8":"-0.786855760"},{"1":"-0.970329438","2":"-0.16776257","3":"-0.72869046","4":"0.68188685","5":"0.87212870","6":"-0.610339642","7":"-1.22427858","8":"-0.445566749"},{"1":"0.217562654","2":"-0.75171997","3":"-0.28367439","4":"-1.09795340","5":"-1.07147240","6":"0.799583665","7":"1.22866327","8":"0.091854579"},{"1":"-1.535992340","2":"0.06237449","3":"-0.66729595","4":"0.33516472","5":"0.77957627","6":"-0.610339642","7":"-0.62386834","8":"-0.315175731"},{"1":"0.217562654","2":"3.09807936","3":"-0.25241215","4":"1.67582360","5":"-0.08424645","6":"-1.674975608","7":"-1.34018056","8":"2.275202817"},{"1":"0.670092975","2":"-0.43382075","3":"-0.67577065","4":"-0.54319800","5":"-0.91721835","6":"0.914679445","7":"0.30144745","8":"0.165448214"},{"1":"0.556960395","2":"-0.78741842","3":"0.13422264","4":"-1.19041263","5":"-1.00977078","6":"1.058549170","7":"0.90945782","8":"-0.690432840"},{"1":"0.443827815","2":"0.29605646","3":"1.05212714","4":"0.05778702","5":"-0.08424645","6":"0.109008984","7":"-0.58016759","8":"-0.334213829"},{"1":"0.952924426","2":"0.16997779","3":"0.63573673","4":"-0.45073876","5":"-0.54700861","6":"0.626939995","7":"-0.37876415","8":"-0.017491241"},{"1":"-2.214787821","2":"-0.62744053","3":"-1.08312138","4":"0.38139434","5":"-0.36190375","6":"-0.782983312","7":"0.08864382","8":"-0.516272977"},{"1":"0.387261525","2":"-0.07549739","3":"-0.04751266","4":"-1.02860897","5":"-0.57785942","6":"0.885905500","7":"0.80115598","8":"-0.161485931"},{"1":"0.160996364","2":"-0.79361262","3":"0.23215254","4":"-0.65877204","5":"-0.79381510","6":"1.202418895","7":"1.41296641","8":"0.340770082"},{"1":"0.613526685","2":"-0.43550029","3":"-3.08559955","4":"-0.86680531","5":"4.69762929","6":"-4.005665155","7":"-2.01659210","8":"-0.758803322"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>From our previous notes, there were a several candidate models that we may have been considering based on their AICc values. In this set of notes we will consider the best <em>k</em>-predictor models that had an AICc value within four of the minimum AICc value. These candidate models include:</p>
<p><span class="math display">\[
\begin{split}
\mathbf{M1:~} \mathrm{Life~Expectancy}_i &amp;= \beta_1(\mathrm{Income}_i) + \epsilon_i \\[1ex]
\mathbf{M2:~} \mathrm{Life~Expectancy}_i &amp;= \beta_1(\mathrm{Income}_i) + \beta_2(\mathrm{Population}_i) + \epsilon_i \\[1ex]
\mathbf{M3:~} \mathrm{Life~Expectancy}_i &amp;= \beta_1(\mathrm{Income}_i) + \beta_2(\mathrm{Population}_i) + \beta_3(\mathrm{Illiteracy~Rate}_i) + \epsilon_i \\[1ex]
\mathbf{M4:~} \mathrm{Life~Expectancy}_i &amp;= \beta_1(\mathrm{Income}_i) + \beta_2(\mathrm{Population}_i) + \beta_3(\mathrm{Illiteracy~Rate}_i) + \beta_4(\mathrm{Murder~Rate}_i) + \epsilon_i
\end{split}
\]</span></p>
<p><br></p>
<section id="evaluating-predictors-cross-validation" class="level1">
<h1>Evaluating Predictors: Cross-Validation</h1>
<p>In practice, we do not typically have two data sets at our disposal. Instead, we randomly split our sample data into two parts: a <em>training</em> set (used to fit the candidate models), and a <em>validation</em> set (used to evaluate the candidate models). Because we use a data set composed of different observations to evaluate the candidate models than we did to fit the candidate models, the resulting evaluation is not biased toward the data we used to fit the model (i.e., less overfit). Because of this, we get better indications about the generalizability of the models to out-of-sample data.</p>
<p>The essential algorithm for cross-validation is:</p>
<ul>
<li>Randomly divide the data into two sets of observations; training and validation data sets.</li>
<li>Fit any candidate models using the training data.</li>
<li>Use the coefficients obtained from the training data to ‚Äúfit‚Äù the exact same models to the validation data to obtain fitted values or residuals.</li>
<li>Use the fitted values/residuals to compute one or more measures of model performance for each candidate model.</li>
<li>Use measures of model performance to select a ‚Äúbest‚Äù candidate model.</li>
</ul>
<div class="note">
<p>There are several metrics of model performance we can use to compare the candidate models. In cross-validation, the model performance metrics are simply compared to determine the ‚Äúbest‚Äù model; there are no significance tests performed.</p>
</div>
<p><br></p>
<section id="cross-validated-mean-square-error-cv-mse" class="level2">
<h2 class="anchored" data-anchor-id="cross-validated-mean-square-error-cv-mse">Cross-Validated Mean Square Error (CV-MSE)</h2>
<p>One very common metric used is the residual variance (a.k.a., mean square error). Because this is computed on the validation data rather than on the data used to fit the model, we refer to it as the <em>Cross-Validated Mean Square Error</em> (CV-MSE). The CV-MSE is:</p>
<p><span class="math display">\[
\mathrm{CV\mbox{-}MSE} = \frac{1}{n} \sum_{i=1}^n e_i^2
\]</span></p>
<p>where <em>n</em> is the number of observations in the validation set, and <span class="math inline">\(e_i\)</span> are the residuals computed on the validation set. This value summarizes the model-data misfit in the validation data. Note that because this is a residual-based measure, lower values of CV-MSE correspond to better fitting models. Because this metric is computed on the validation data (data not used to initially fit the model), it is a better measure of how the model might perform in future samples.</p>
<p><br></p>
</section>
</section>
<section id="cross-validation-example" class="level1">
<h1>Cross-Validation Example</h1>
<p>To select a ‚Äúbest‚Äù model from our candidate models for the <code>z_usa</code> data, we can use cross-validation based on the following:</p>
<ol type="1">
<li>Randomly divide the <code>z_usa</code> data into two sets of observations; training and validation data sets.</li>
<li>Fit the four candidate models to the training observations.</li>
<li>Use the estimated coefficients from those fitted models to obtain the fitted values and residuals for the observations in the validation data. Using these residuals, compute the CV-MSE for each candidate model.</li>
<li>Select the model with the lowest CV-MSE.</li>
</ol>
<p>Next, we will explore and carry out each of the steps in this algorithm to select a ‚Äúbest‚Äù model from our candidate models for the <code>z_usa</code> data.</p>
<p><br></p>
<section id="divide-the-sample-data-into-a-training-and-validation-set" class="level2">
<h2 class="anchored" data-anchor-id="divide-the-sample-data-into-a-training-and-validation-set">Divide the Sample Data into a Training and Validation Set</h2>
<p>There are many ways to do this, but here we will use the <code>sample()</code> function to randomly sample 35 cases (rows) from the <code>z_usa</code> data (about 2/3 of the data). These 35 cases will make up the training data. Then we will use the <code>filter()</code> function to select those cases. The remaining cases (those 17 observations not sampled) are put into a validation set of data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the random sampling replicable</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the cases to be in the training set</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>training_cases <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(z_usa), <span class="at">size =</span> <span class="dv">35</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training data from the sampled cases</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> z_usa <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> training_cases)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create validation data from the remaining cases</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>validate <span class="ot">=</span> z_usa <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> training_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="fit-the-candidate-models-to-the-training-data" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-candidate-models-to-the-training-data">Fit the Candidate Models to the Training Data</h2>
<p>We now fit the four candidate models to the observations in the training data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income,                                    <span class="at">data =</span> train)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population,                       <span class="at">data =</span> train)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy,          <span class="at">data =</span> train)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.4</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy <span class="sc">+</span> murder, <span class="at">data =</span> train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="use-the-coefficients-from-the-fitted-models-and-the-validation-data-to-obtain-fitted-values-residuals-and-cv-mses" class="level2">
<h2 class="anchored" data-anchor-id="use-the-coefficients-from-the-fitted-models-and-the-validation-data-to-obtain-fitted-values-residuals-and-cv-mses">Use the Coefficients from the Fitted Models and the Validation Data to Obtain Fitted Values, Residuals, and CV-MSEs</h2>
<p>Now we can obtain the predicted life expectancy for the observations in the validation data based on the coefficients from the models fitted to the training data. These vectors of fitted values can be used to compute the residuals for the validation observations, which in turn can be used to compute the CV-MSE.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the predicted values for the validation data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>yhat_1 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.1</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>yhat_2 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.2</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>yhat_3 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.3</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>yhat_4 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.4</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute residuals and CV-MSE</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_1) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(validate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7349516</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_2) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(validate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7483797</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_3) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(validate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8547222</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_4) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(validate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8968336</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="select-candidate-model-with-the-lowest-cv-mse" class="level2">
<h2 class="anchored" data-anchor-id="select-candidate-model-with-the-lowest-cv-mse">Select Candidate Model with the Lowest CV-MSE</h2>
<p>Since the CV-MSE is a measure of model misfit, the candidate model having the smallest CV-MSE is the model that should be adopted. In this case, the values for the CV-MSE suggest adopting the single predictor model.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>CV-MSE for four potential models based on simple cross-validation. </caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">CV-MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1-Predictor Model</td>
<td style="text-align: center;"><span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #eeff41 !important;">0.735</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">2-Predictor Model</td>
<td style="text-align: center;">0.748</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3-Predictor Model</td>
<td style="text-align: center;">0.855</td>
</tr>
<tr class="even">
<td style="text-align: left;">4-Predictor Model</td>
<td style="text-align: center;">0.897</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><br></p>
</section>
</section>
<section id="leave-one-out-cross-validation" class="level1">
<h1>Leave-One-Out Cross-Validation</h1>
<p>There are two major problems with the cross-validation we just performed.</p>
<ol type="1">
<li>The estimate of the CV-MSE is highly dependent on the observations chosen to be in the training and validation sets. This is illustrated in the figure below which shows the CV-MSE values for the four models for 10 different random splits of the data. Some of these splits support adopting the first candidate model, other splits support adopting the second candidate model, while others support adopting the third or even the fourth candidate models!</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14-cross-validation_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Model that has the lowest CV-MSE for 10 random splits of the data.</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Only a subset of the observations (those in the training set) are used to initially fit the model. Since statistical methods tend to perform worse when trained on fewer observations, this suggests that the CV-MSE may tend to overestimate the error rate (model accuracy measure) for the model fit.</li>
</ol>
<p>Leave-one-out cross-validation (LOOCV) is one method that can be used to overcome these issues. The algorithm for performing LOOCV is:</p>
<ol type="1">
<li>Hold out the <em>i</em>th observation as your validation data (a single observation) and use the remaining <span class="math inline">\(n-1\)</span> observations as your training data.</li>
<li>Fit all candidate models to the training data.</li>
<li>Use the estimated coefficients from those fits to compute the <span class="math inline">\(\mathrm{CV\mbox{-}MSE}_i\)</span> using the validation data.</li>
<li>Repeat Steps 2‚Äì4 for each observation.</li>
</ol>
<p>We then have <em>n</em> estimates of the CV-MSE that can be averaged to get an overall estimate for the CV-MSE. That is,</p>
<p><span class="math display">\[
\mathrm{CV\mbox{-}MSE} = \frac{1}{n} \sum_{i=1}^n \widehat{\mathrm{CV\mbox{-}MSE}}_i
\]</span></p>
<p>where <span class="math inline">\(\widehat{\mathrm{CV\mbox{-}MSE}}_i\)</span> is the estimated CV-MSE based on the validation set composed of the <em>i</em>th observation. Since the validation dataset is composed of a single observation (<span class="math inline">\(n=1\)</span>), <span class="math inline">\(\mathrm{CV\mbox{-}MSE}_i\)</span> is simply the squared residual value for the validation observation. That is,</p>
<p><span class="math display">\[
\begin{split}
\widehat{\mathrm{CV\mbox{-}MSE}}_i = \frac{1}{n} \sum_{i=1}^n e_i^2 \\[0.5em]
= \frac{1}{1} \sum_{i=1}^1 e_i^2 \\[0.5em]
= e_i^2
\end{split}
\]</span> <br></p>
<section id="function-to-carry-out-loocv" class="level2">
<h2 class="anchored" data-anchor-id="function-to-carry-out-loocv">Function to Carry Out LOOCV</h2>
<p>To carry out LOOCV, we will write a function that computes <span class="math inline">\(\widehat{\mathrm{CV\mbox{-}MSE}}_i\)</span> for each model given a particular case.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute CV-MSE for LOOCV</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cv_mse_i <span class="ot">=</span> <span class="cf">function</span>(case_index){</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create training and validation data sets</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">=</span> z_usa <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> case_index)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  validate <span class="ot">=</span> z_usa <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> case_index)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit models to training data</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income,                                    <span class="at">data =</span> train)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population,                       <span class="at">data =</span> train)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy,          <span class="at">data =</span> train)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.4</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy <span class="sc">+</span> murder, <span class="at">data =</span> train)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute fitted value for validation data</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  yhat_1 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.1</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  yhat_2 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.2</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  yhat_3 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.3</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  yhat_4 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.4</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute CV-MSE_i for each model</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  cv_mse_1 <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_1) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  cv_mse_2 <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_2) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  cv_mse_3 <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_3) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  cv_mse_4 <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_4) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Output a data frame</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(cv_mse_1, cv_mse_2, cv_mse_3, cv_mse_4))</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Test function on Case 1</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cv_mse_i</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["cv_mse_1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cv_mse_2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["cv_mse_3"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cv_mse_4"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2.08481","2":"1.988258","3":"1.383972","4":"1.297868","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Then we can use this function to compute the four <span class="math inline">\(\widehat{\mathrm{CV\mbox{-}MSE}}_i\)</span> values for each case in the data. We set up a data frame that includes a column called <code>case</code> that has each case number in the data. Then we use <code>rowwise()</code> to operate on each row separately and <code>mutate()</code> a new column by applying our <code>cv_mse_i()</code> function using <code>map()</code>. This creates a <em>list column</em> where the contents of each cell in the column is actually a list; in our case a data frame of four columns. Finally, we use <code>unnest()</code> to take the contents of the list column and spread them out into separate columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply cv_mse_i() function to all cases</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>my_cv_mse <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">case =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">52</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cv_mse =</span> <span class="fu">map</span>(case, cv_mse_i) <span class="co">#New list column that includes the data frame of output</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> cv_mse) <span class="co">#Turn list column into multiple columns</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View output</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>my_cv_mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["case"],"name":[1],"type":["int"],"align":["right"]},{"label":["cv_mse_1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["cv_mse_2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cv_mse_3"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["cv_mse_4"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2.084810130","3":"1.9882578052","4":"1.38397159247","5":"1.297868444"},{"1":"2","2":"0.150900695","3":"0.0504382607","4":"0.06808356332","5":"0.001132126"},{"1":"3","2":"0.869823055","3":"0.8164548577","4":"0.95625620472","5":"0.888907105"},{"1":"4","2":"1.195324253","3":"1.0186874078","4":"0.62851608660","5":"0.615671557"},{"1":"5","2":"2.104167949","3":"0.7731378792","4":"0.65672991737","5":"0.562273253"},{"1":"6","2":"0.424822774","3":"0.4556548806","4":"0.31488696678","5":"0.330855966"},{"1":"7","2":"0.054396628","3":"0.1139547839","4":"0.03095797326","5":"0.053704046"},{"1":"8","2":"0.136114184","3":"0.0471327866","4":"0.02295382454","5":"0.014313644"},{"1":"9","2":"4.620693190","3":"3.8271774336","4":"1.79966596773","5":"1.243909044"},{"1":"10","2":"0.819598361","3":"0.2747830705","4":"0.53058692668","5":"0.449958925"},{"1":"11","2":"0.063610930","3":"0.1431324490","4":"0.01796598673","5":"0.023773078"},{"1":"12","2":"3.651121079","3":"4.2873738068","4":"7.06563041837","5":"6.637385726"},{"1":"13","2":"0.586328984","3":"0.8017735100","4":"0.85248821139","5":"0.588938115"},{"1":"14","2":"0.021979161","3":"0.0006621793","4":"0.01137821404","5":"0.000203531"},{"1":"15","2":"0.440796911","3":"0.4609738026","4":"0.97048474014","5":"0.851149317"},{"1":"16","2":"0.157636124","3":"0.2388102856","4":"0.07340001495","5":"0.025503068"},{"1":"17","2":"0.004367278","3":"0.0008940476","4":"0.02780230602","5":"0.035731500"},{"1":"18","2":"2.104080495","3":"1.9737784524","4":"1.76037050749","5":"1.883848601"},{"1":"19","2":"1.315103663","3":"1.2198231846","4":"0.61562126653","5":"0.363610201"},{"1":"20","2":"0.001365469","3":"0.0318469475","4":"0.00002658336","5":"0.015415037"},{"1":"21","2":"0.295245484","3":"0.2724485207","4":"0.30387575511","5":"0.098113338"},{"1":"22","2":"0.067621661","3":"0.0661514859","4":"0.01175376082","5":"0.010492295"},{"1":"23","2":"0.053684409","3":"0.1137777915","4":"0.50063709837","5":"0.441152670"},{"1":"24","2":"0.731394565","3":"0.7786327592","4":"0.26232581923","5":"0.233020716"},{"1":"25","2":"2.312288062","3":"2.0681011073","4":"1.18355079704","5":"1.494711605"},{"1":"26","2":"0.340717217","3":"0.3369679204","4":"0.82272061925","5":"0.511709416"},{"1":"27","2":"0.078982528","3":"0.1853934774","4":"0.12592904537","5":"0.070473551"},{"1":"28","2":"0.355586578","3":"0.5243297828","4":"0.27589404911","5":"0.186196208"},{"1":"29","2":"0.017170473","3":"0.0485869584","4":"0.42576310091","5":"0.427020619"},{"1":"30","2":"0.020520988","3":"0.0001025051","4":"0.09263816580","5":"0.110342824"},{"1":"31","2":"0.017864305","3":"0.0053573313","4":"0.16974254772","5":"0.166759880"},{"1":"32","2":"0.010305090","3":"0.0471891476","4":"0.52415292089","5":"0.568641710"},{"1":"33","2":"1.089674193","3":"0.5246094696","4":"1.52234607008","5":"1.290278187"},{"1":"34","2":"0.023507570","3":"0.0754245080","4":"0.06205846125","5":"0.058808605"},{"1":"35","2":"0.058664640","3":"0.1709265238","4":"0.02764842801","5":"0.023645226"},{"1":"36","2":"0.783517185","3":"1.0970483164","4":"2.04240195223","5":"2.009021642"},{"1":"37","2":"1.542230121","3":"1.3942402382","4":"1.17285295596","5":"1.260166499"},{"1":"38","2":"0.476927151","3":"0.5638814131","4":"0.48420273672","5":"0.333601498"},{"1":"39","2":"0.093507136","3":"0.2418581348","4":"0.36029481891","5":"0.283606966"},{"1":"40","2":"0.202788554","3":"0.3714969092","4":"0.26517094334","5":"0.173914678"},{"1":"41","2":"0.377307930","3":"0.3428810915","4":"0.12133085975","5":"0.090081958"},{"1":"42","2":"0.129051208","3":"0.2665149564","4":"0.10169935874","5":"0.031256355"},{"1":"43","2":"1.475413905","3":"1.5199811202","4":"1.30980660008","5":"1.194006279"},{"1":"44","2":"0.118025660","3":"0.1293180086","4":"0.19420417045","5":"0.259549507"},{"1":"45","2":"1.030898121","3":"1.2167060596","4":"1.03356728873","5":"0.773625753"},{"1":"46","2":"0.240460343","3":"0.4359579214","4":"0.19754161957","5":"0.118479312"},{"1":"47","2":"0.006608695","3":"0.0182090537","4":"0.02943297562","5":"0.011719787"},{"1":"48","2":"0.411878072","3":"0.3745549241","4":"0.19759026983","5":"0.183782332"},{"1":"49","2":"2.942851946","3":"2.5730144801","4":"1.92728474270","5":"2.549537528"},{"1":"50","2":"0.168850174","3":"0.1814750830","4":"0.01570768989","5":"0.005815210"},{"1":"51","2":"0.002076207","3":"0.0450043229","4":"0.02479800135","5":"0.005186411"},{"1":"52","2":"6.977634377","3":"7.4434988067","4":"6.39227540838","5":"27.589014985"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="alternative-programming-use-a-for-loop" class="level2">
<h2 class="anchored" data-anchor-id="alternative-programming-use-a-for-loop">Alternative Programming: Use a for() Loop</h2>
<p>Alternatively, we could also have used a <code>for()</code> loop to carry out the LOOCV. Here is some example syntax (not run):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up empty vector to store results</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mse_1 <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">52</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>mse_2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">52</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>mse_3 <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">52</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>mse_4 <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">52</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>mse_5 <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">52</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the cross-validation</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(z_usa)){</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">=</span> z_usa <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> i)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  validate <span class="ot">=</span> z_usa <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> i)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income,                                    <span class="at">data =</span> train)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population,                       <span class="at">data =</span> train)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy,          <span class="at">data =</span> train)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  lm<span class="fl">.4</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy <span class="sc">+</span> murder, <span class="at">data =</span> train)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  yhat_1 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.1</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  yhat_2 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.2</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  yhat_3 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.3</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  yhat_4 <span class="ot">=</span> <span class="fu">predict</span>(lm<span class="fl">.4</span>, <span class="at">newdata =</span> validate)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  mse_1[i] <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_1) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  mse_2[i] <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_2) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  mse_3[i] <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_3) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  mse_4[i] <span class="ot">=</span> (validate<span class="sc">$</span>life_expectancy <span class="sc">-</span> yhat_4) <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame of results</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>my_cv_mse <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">case =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">52</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv_mse_1 =</span> mse_1, </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv_mse_2 =</span> mse_2,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv_mse_3 =</span> mse_3,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv_mse_4 =</span> mse_4</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="select-model-with-lowest-cv-mse" class="level2">
<h2 class="anchored" data-anchor-id="select-model-with-lowest-cv-mse">Select Model with Lowest CV-MSE</h2>
<p>We can now compute the average CV-MSE for each of the candidate models and select the candidate model with the lowest average CV-MSE.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute average CV-MSE</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>my_cv_mse <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>case) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_all</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cv_mse_1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cv_mse_2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["cv_mse_3"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cv_mse_4"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.8319288","2":"0.8068921","3":"0.7686342","4":"1.123998"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The LOOCV results suggest that we adopt the three-predictor model; it has the smallest average CV-MSE. Since LOOCV method is less biased than simple cross-validation (it trains the models on a much larger set of observations) its results are more believable than those from the simple cross-validation. Another advantage of LOOCV is that it will always produce the same results as opposed to simple cross-validation) since there is no randomness in producing the training and validation datasets.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>CV-MSE for four potential models based on simple cross-validation and Leave-One-Out Cross-Validation (LOOCV). </caption>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
CV-MSE
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Simple CV</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">LOOCV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1-Predictor Model</td>
<td style="text-align: center;"><span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #eeff41 !important;">0.735</span></td>
<td style="text-align: center;">0.832</td>
</tr>
<tr class="even">
<td style="text-align: left;">2-Predictor Model</td>
<td style="text-align: center;">0.748</td>
<td style="text-align: center;">0.807</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3-Predictor Model</td>
<td style="text-align: center;">0.855</td>
<td style="text-align: center;"><span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #eeff41 !important;">0.769</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">4-Predictor Model</td>
<td style="text-align: center;">0.897</td>
<td style="text-align: center;">1.124</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><br></p>
<section id="computing-the-cv-mse-under-loocv-a-shortcut-for-ols-models" class="level3">
<h3 class="anchored" data-anchor-id="computing-the-cv-mse-under-loocv-a-shortcut-for-ols-models">Computing the CV-MSE under LOOCV: A Shortcut for OLS Models</h3>
<p>LOOCV can be computationally expensive when you sample is very large; we have to fit the candidate models <em>n</em> times. It turns out, however, that models fit with OLS, can give us the LOOCV results using the following formula:</p>
<p><span class="math display">\[
\mathrm{CV\mbox{-}MSE} = \frac{1}{n} \sum_{i=1}^n \bigg(\frac{e_i}{1-h_{ii}}\bigg)^2
\]</span></p>
<p>where <span class="math inline">\(\hat{y}_i\)</span> is the <em>i</em>th fitted value from the original least squares fit, and <span class="math inline">\(h_{ii}\)</span> is the leverage value. This is similar to the model (biased) MSE, except the <em>i</em>th residual is divided by <span class="math inline">\(1 ‚àí h_{ii}\)</span>. Below, we compute the LOOCV CV-MSE for the three-predictor candidate model</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute CV-MSE for Candidate Model 3</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy, <span class="at">data =</span> z_usa)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Augment the model to get e_i and h_ii</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>out<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">augment</span>(lm<span class="fl">.3</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute CV-MSE for best three-predictor model</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="dv">52</span> <span class="sc">*</span> <span class="fu">sum</span>((out<span class="fl">.3</span><span class="sc">$</span>.resid <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> out<span class="fl">.3</span><span class="sc">$</span>.hat))<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7686342</code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
</section>
<section id="k-fold-cross-validation" class="level1">
<h1>k-Fold Cross-Validation</h1>
<p>LOOCV is a very general method, and can be used with any kind of modeling. For example we could use it with logistic regression, or mixed-effects analysis, or any of the methods you have encountered in your statistics courses to date. That being said, the shortcut formula does not hold for all these methods, so, outside of OLS regression, the candidate models will actually need to be fitted <em>n</em> times. This can, as pointed out earlier, be quite computationally expensive.</p>
<p>One alternative to LOOCV is <em>k</em>-fold cross-validation. The algorithm for <em>k</em>-fold cross-validation is:</p>
<ol type="1">
<li>Randomly divide the data into <em>k</em> groups or folds.</li>
<li>Hold out the <em>i</em>th fold as your validation data and use the remaining <span class="math inline">\(k-1\)</span> folds as your training data.</li>
<li>Fit all candidate models to the training data.</li>
<li>Use the estimated coefficients from those fits to compute <span class="math inline">\(\mathrm{CV\mbox{-}MSE}_i\)</span> using the validation data.</li>
<li>Repeat Steps 2‚Äì4 for each fold.</li>
</ol>
<p>We then have <em>k</em> estimates of the MSE that can be averaged to get the overall CV-MSE.</p>
<p><span class="math display">\[
\mathrm{CV\mbox{-}MSE} = \frac{1}{k} \sum_{j=1}^k \widehat{\mathrm{CV\mbox{-}MSE}}_j
\]</span></p>
<p>where <span class="math inline">\(\widehat{\mathrm{CV\mbox{-}MSE}}_j\)</span> is the estimated CV-MSE based on the <em>j</em>th validation set. From this algorithm, it is clear that LOOCV is a special case of <em>k</em>-fold cross-validation in which <em>k</em> is set to equal <em>n</em>. In practice we typically use <span class="math inline">\(k=5\)</span> or <span class="math inline">\(k=10\)</span>.</p>
<p>We can carry out <em>k</em>-fold cross-validation by using the <code>crossv_kfold()</code> function from the <code>{modelr}</code> package. This function takes the argument <code>k=</code> to indicate the number of folds. Here is some example syntax to carry out a 10-fold cross-validation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducible results</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide data into 10 folds</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>my_cv <span class="ot">=</span> z_usa <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossv_kfold</span>(<span class="at">k =</span> <span class="dv">10</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># View output</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>my_cv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["train"],"name":[1],"type":["named list"],"align":["right"]},{"label":["test"],"name":[2],"type":["named list"],"align":["right"]},{"label":[".id"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"<S3: resample>","2":"<S3: resample>","3":"01"},{"1":"<S3: resample>","2":"<S3: resample>","3":"02"},{"1":"<S3: resample>","2":"<S3: resample>","3":"03"},{"1":"<S3: resample>","2":"<S3: resample>","3":"04"},{"1":"<S3: resample>","2":"<S3: resample>","3":"05"},{"1":"<S3: resample>","2":"<S3: resample>","3":"06"},{"1":"<S3: resample>","2":"<S3: resample>","3":"07"},{"1":"<S3: resample>","2":"<S3: resample>","3":"08"},{"1":"<S3: resample>","2":"<S3: resample>","3":"09"},{"1":"<S3: resample>","2":"<S3: resample>","3":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The output of <code>cross_kfold()</code> is a tibble/data frame with three columns: <code>train</code>, <code>test</code>, and <code>.id</code>. The first two columns are named lists of <code>resample</code> objects. These contain references to the row numbers used in the training and test data sets.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View rows used in first fold (train set)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>my_cv<span class="sc">$</span>train[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;resample [46 x 8]&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, ...</code></pre>
</div>
</div>
<p>Then we will use the <code>map()</code> and <code>map2_dbl()</code> functions from the <code>{purrr}</code> package to fit a model to the training (<code>train</code>) data and find the MSE on the validation (<code>test</code>) data created from the <code>crossv_kfold()</code> function. We will have to carry this out for each of the candidate models.</p>
<div class="fyi">
<p>For more detailed information about using the purrr functions, see Jenny Bryan‚Äôs fantastic <a href="https://jennybc.github.io/purrr-tutorial/index.html">purrr tutorial</a>.</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Best 1-predictor model</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>cv_1 <span class="ot">=</span> my_cv <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(train, <span class="sc">~</span><span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> income, <span class="at">data =</span> .)),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MSE =</span> <span class="fu">map2_dbl</span>(model, test, modelr<span class="sc">::</span>mse),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> <span class="dv">1</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Best 2-predictor model</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>cv_2 <span class="ot">=</span> my_cv <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(train, <span class="sc">~</span><span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population, <span class="at">data =</span> .)),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">MSE =</span> <span class="fu">map2_dbl</span>(model, test, modelr<span class="sc">::</span>mse),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> <span class="dv">2</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Best 3-predictor model</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>cv_3 <span class="ot">=</span> my_cv <span class="sc">|&gt;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(train, <span class="sc">~</span><span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy, <span class="at">data =</span> .)),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">MSE =</span> <span class="fu">map2_dbl</span>(model, test, modelr<span class="sc">::</span>mse),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> <span class="dv">3</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Best 4-predictor model</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>cv_4 <span class="ot">=</span> my_cv <span class="sc">|&gt;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(train, <span class="sc">~</span><span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy <span class="sc">+</span> murder, <span class="at">data =</span> .)),</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">MSE =</span> <span class="fu">map2_dbl</span>(model, test, modelr<span class="sc">::</span>mse),</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> <span class="dv">4</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have the results, we can stack these into single data frame and then use <code>group_by()</code> and <code>summarize()</code> to obtain the CV-MSE estimates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cv_1, cv_2, cv_3, cv_4) <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(k) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cv_mse =</span> <span class="fu">mean</span>(MSE)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["k"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cv_mse"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.8847779"},{"1":"2","2":"0.8588566"},{"1":"3","2":"0.8304027"},{"1":"4","2":"1.2214235"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The results of carrying out the 10-fold cross-validation suggest that we adopt the best two- or three-predictor model.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>CV-MSE for four potential models based on simple cross-validation, Leave-One-Out Cross-Validation (LOOCV), and 10-fold cross-validation. </caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
CV-MSE
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Simple CV</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">LOOCV</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">10-Fold CV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1-Predictor Model</td>
<td style="text-align: center;"><span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #eeff41 !important;">0.735</span></td>
<td style="text-align: center;">0.832</td>
<td style="text-align: center;">0.885</td>
</tr>
<tr class="even">
<td style="text-align: left;">2-Predictor Model</td>
<td style="text-align: center;">0.748</td>
<td style="text-align: center;">0.807</td>
<td style="text-align: center;">0.859</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3-Predictor Model</td>
<td style="text-align: center;">0.855</td>
<td style="text-align: center;"><span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #eeff41 !important;">0.769</span></td>
<td style="text-align: center;"><span style=" font-weight: bold;    border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #eeff41 !important;">0.831</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">4-Predictor Model</td>
<td style="text-align: center;">0.897</td>
<td style="text-align: center;">1.124</td>
<td style="text-align: center;">1.22</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Using <em>k</em>-fold cross-validation is computationally less expensive so long as <span class="math inline">\(k&lt;n\)</span>. But this computational gain has a cost in that the results are again dependent on the <em>k</em> random splits. This variation, however, is less than that in the single split simple cross-validation. We can also alleviate some of this by fitting the <em>k</em>-fold cross-validation several times and averaging across the results to get the CV-MSE estimate.</p>
<div class="fyi">
<p>There are several other R packages that will also fit a <em>k</em>-fold cross-validation (e.g., <code>{DAAG}</code>).</p>
</div>
<p><br></p>
<p><br></p>
</section>
<section id="model-selection" class="level1">
<h1>Model Selection</h1>
<p>The different model selection methods suggest we adopt the following candidate models:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Predictors selected from forward selection (FS), backward elimination (BE) and cross-validation (CV) methods. The CV-MSE was used as a performance metric for model selection in all cross-validation methods.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Method</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FS (t-value)</td>
<td style="text-align: left;">Income, Population, Illiteracy, Murder</td>
</tr>
<tr class="even">
<td style="text-align: left;">FS (AIC)</td>
<td style="text-align: left;">Income, Population, Illiteracy</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BE (R2)</td>
<td style="text-align: left;">Income, Population, Illiteracy</td>
</tr>
<tr class="even">
<td style="text-align: left;">All Subsets (AICc)</td>
<td style="text-align: left;">Income, Population, Illiteracy</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Simple CV</td>
<td style="text-align: left;">Income</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leave-One-Out CV</td>
<td style="text-align: left;">Income, Population, Illiteracy</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10-Fold CV</td>
<td style="text-align: left;">Income, Population, Illiteracy</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="fyi">
<p>While the different CV methods can suggest different models, this is usually less problematic when the sample size is larger; we only have 52 observations in the <code>z_usa</code> data.</p>
</div>
<p>The LOOCV and <em>k</em>-fold CV are better suited for considering how the model will perform on future data sets, so, here, I would adopt the model that includes income, population, and illiteracy rate. To get the coefficient estimates, we fit whichever model we adopt to the FULL data set (with all the observations) as this will give us the ‚Äúbest‚Äù estimates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy, <span class="at">data =</span> z_usa)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get model-level output</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(lm<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[11],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[12],"type":["int"],"align":["right"]}],"data":[{"1":"0.3494565","2":"0.3096273","3":"0.8228586","4":"8.773877","5":"0.00009239393","6":"3","7":"-62.10131","8":"132.2026","9":"140.0076","10":"33.17772","11":"49","12":"52"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coefficient-level output</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lm<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"income","2":"0.4876851","3":"0.1153093","4":"4.229363","5":"0.0001020906"},{"1":"population","2":"0.3923549","3":"0.1452027","4":"2.702119","5":"0.0094390550"},{"1":"illiteracy","2":"-0.3096511","3":"0.1451187","4":"-2.133778","5":"0.0378919617"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="reporting-results-from-a-cross-validation" class="level1">
<h1>Reporting Results from a Cross-Validation</h1>
<p>When we report the results of a regression model evaluated using cross-validation, there are some subtle differences in what is reported. At the model-level, we report the <span class="math inline">\(R^2\)</span> from the adopted model fitted to the full-data. We also report the CV-MSE as a measure of the model error for future observations (generalized error).</p>
<p>At the coefficient-level we typically report the coefficient estimates and standard errors based on fitting the adopted model to the full data. However, we DO NOT REPORT NOR INTERPRET P-VALUES. The <em>p</em>-values do not take into account that the model was selected using cross-validation. Because of this they are incredibly misleading. As with any model, interpretations should also be offered, again typically by way of providing a plot of the fitted model to help facilitate these interpretations. For example:</p>
<div class="interpret">
<p>The regression model using income, population, and illiteracy rate to predict variation in life expectancy was selected using 10-fold cross-validation (CV-MSE = 0.830). The model explains 34.9% of the variation in life expectancy. The fitted equation is:</p>
<p><span class="math display">\[
\begin{split}
\hat{\mathrm{Life~Expectancy}}_i = &amp;0.488(\mathrm{Income}_i) + 0.392(\mathrm{Population}_i) \\
&amp;- 0.310(\mathrm{Illiteracy~Rate}_i)
\end{split}
\]</span></p>
<p>where, the outcome and all predictors are standardized. This model suggests moderate, positive, partial effects of both income and population and a moderate negative effect of illiteracy rate on life expectancy.</p>
</div>
<p><br></p>
</section>
<section id="relationship-between-information-criteria-and-cross-validation" class="level1">
<h1>Relationship between Information Criteria and Cross-Validation</h1>
<p>In EPsy 8252, we learned about using <a href="https://zief0002.github.io/epsy-8252/misc/s21-12-information-criteria-and-model-selection.html">information criteria for model selection</a>. In particular, we used AIC, BIC, and AICc for model selection. It turns out the AIC-based model selection and cross-validation are asymptotically equivalent <span class="citation" data-cites="Stone:1977">(<a href="#ref-Stone:1977" role="doc-biblioref">Stone, 1977</a>)</span>. <span class="citation" data-cites="Shao:1997">Shao (<a href="#ref-Shao:1997" role="doc-biblioref">1997</a>)</span> also proved that for linear models, using BIC for model selection is asymptotically equivalent to leave-<em>v</em>-out cross-validation when</p>
<p><span class="math display">\[
v = n\bigg(1 - \frac{1}{\ln (n) - 1}\bigg)
\]</span></p>
<p>As a practical note, computer simulations have suggested that the results from using AICc for model selection will, on average, be quite similar to those from cross-validation techniques. As such, AICc can be a useful alternative to the computationally expensive cross-validation methods. However, using AICc does not provide a measure of the model performance (MSE) in new datasets like cross-validation does.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models to all data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income,                                    <span class="at">data =</span> z_usa)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population,                       <span class="at">data =</span> z_usa)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy,          <span class="at">data =</span> z_usa)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>lm<span class="fl">.4</span> <span class="ot">=</span> <span class="fu">lm</span>(life_expectancy <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> income <span class="sc">+</span> population <span class="sc">+</span> illiteracy <span class="sc">+</span> murder, <span class="at">data =</span> z_usa)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load library</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get AICc for all models</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">aictab</span>(</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cand.set =</span> <span class="fu">list</span>(lm<span class="fl">.1</span>, lm<span class="fl">.2</span>, lm<span class="fl">.3</span>, lm<span class="fl">.4</span>),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">modnames =</span> <span class="fu">c</span>(<span class="st">"Best 1-Predictor"</span>, <span class="st">"Best 2-Predictor"</span>, <span class="st">"Best 3-Predictor"</span>, <span class="st">"Best 4-Predictor"</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Modnames"],"name":[1],"type":["chr"],"align":["left"]},{"label":["K"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["AICc"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Delta_AICc"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ModelLik"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["AICcWt"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["LL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Cum.Wt"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Best 3-Predictor","2":"4","3":"133.0537","4":"0.000000","5":"1.0000000","6":"0.4766122","7":"-62.10131","8":"0.4766122","_rn_":"3"},{"1":"Best 4-Predictor","2":"5","3":"134.2494","4":"1.195668","5":"0.5500017","6":"0.2621376","7":"-61.47250","8":"0.7387498","_rn_":"4"},{"1":"Best 2-Predictor","2":"3","3":"135.3229","4":"2.269225","5":"0.3215468","6":"0.1532531","7":"-64.41145","8":"0.8920029","_rn_":"2"},{"1":"Best 1-Predictor","2":"2","3":"136.0229","4":"2.969198","5":"0.2265932","6":"0.1079971","7":"-65.88899","8":"1.0000000","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The model with the lowest AICc is, indeed, the three-predictor model. There is also some evidence for the four-predictor model given the AICc weight.</p>
<p><br></p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Shao:1997" class="csl-entry" role="listitem">
Shao, J. (1997). An asymptotic theory for linear model selection. <em>Statistica Sinica</em>, <em>7</em>, 221‚Äì264.
</div>
<div id="ref-Stone:1977" class="csl-entry" role="listitem">
Stone, M. (1977). An asymptotic equivalence of choice of model by cross-validation and akaike‚Äôs criterion. <em>Journal of the Royal Statistical Society, Series B</em>, <em>39</em>, 44‚Äì47.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>